<html>
<head>
	<meta charset="UTF-8">
	<title>Significance Calculator</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  
  <link rel="stylesheet" type="text/css" class="ui" href="/semantic/packaged/css/semantic.css">
  

</head>
<body>
	<div class="ui button">Follow</div>

<div class="margins">

<h3 class="ui header"><strong>Metrics</strong></h3>

<table class="ui celled table segment">
    <tr>
        <th>Experience</th>
        <th>Visitors</th>
        <th>Forms</th>
        <th>Calls</th>
        <th>Total Leads</th>
    </tr>
    <tr class="exp1 positive">
        <td><div class="ui input">
  <input type="text" placeholder="Control Name">
</div></td>
        <td class="visitors"></td>
        <td class="forms"></td>
        <td class="calls"></td>
        <td class="total"></td>
    </tr>
    <tr class="exp2">
        <td class="experience"></td>
        <td class="visitors"></td>
        <td class="forms"></td>
        <td class="calls"></td>
        <td class="total"></td>
    </tr>
</table>

<h3><strong>Outbound Leads (Forms)</strong></h3>

<table class="ui celled table segment">
    <tr>
        <th>Experince</th>
        <th>Response Rate%</th>
        <th>Lift %</th>
        <th>Confidence</th>
    </tr>
    <tr class="exp1 positive">
        <td class="experience"></td>
        <td class="fRR"></td>
        <td class="fLift">-</td>
        <td class="fConf">-</td>
    </tr>
    <tr class="exp2">
        <td class="experience"></td>
        <td class="fRR"></td>
        <td class="fLift"></td>
        <td class="fConf"><i class="icon checkmark"></i></td>
    </tr>
</table>
<h3><strong>Inbound Leads (Calls)</strong></h3>
<table class="ui celled table segment">
    <tr>
        <th>Experince</th>
        <th>Response Rate%</th>
        <th>Lift %</th>
        <th>Confidence</th>
    </tr>
    <tr class="exp1 positive">
        <td class="experience"></td>
        <td class="cRR"></td>
        <td class="cLift">-</td>
        <td class="cConf">-</td>
    </tr>
    <tr class="exp2">
        <td class="experience"></td>
        <td class="cRR"></td>
        <td class="cLift"></td>
        <td class="cConf"></td>
    </tr>
</table>
<h3><strong>Total Leads</strong></h3>
<table class="ui celled table segment">
    <tr>
        <th>Experince</th>
        <th>Response Rate%</th>
        <th>Lift %</th>
        <th>Confidence</th>
    </tr>
    <tr class="exp1 positive">
        <td class="experience"></td>
        <td class="tRR"></td>
        <td class="tLift">-</td>
        <td class="cConf">-</td>
    </tr>
    <tr class="exp2">
        <td class="experience"></td>
        <td class="tRR"></td>
        <td class="tLift"></td>
        <td class="tConf"><i class="icon checkmark"></i></td>
    </tr>
</table>
</div>
</body>
<script>
	//Assumptions
var percentile = 3;

//Experience 1
var exp1Name = "Pannel Top";
var exp1Visitors = 1064;
var exp1Forms = 320;
var exp1Calls = 52;
var exp1Total = exp1Forms + exp1Calls;

var exp1fRR = responseRate(exp1Visitors, exp1Forms);
var exp1fRR_p = toPercent(exp1fRR, 2);
var exp1Forms_se = se(exp1Forms,exp1Visitors);
var exp1Forms_ci = confInt(exp1Forms_se,percentile);
var exp1Min = exp1fRR - exp1Forms_ci;
var exp1Max = exp1fRR + exp1Forms_ci;
var exp1fRR_TT = ((exp1fRR-exp1Forms_ci)*100).toFixed(2)+"% to "+((exp1fRR+exp1Forms_ci)*100).toFixed(2)+"%";

var exp1cRR = responseRate(exp1Visitors, exp1Calls);
var exp1cRR_p = toPercent(exp1cRR, 2);
var exp1Calls_se = se(exp1Calls,exp1Visitors);
var exp1Calls_ci = confInt(exp1Calls_se,percentile);
var exp1Min_c = exp1cRR - exp1Calls_ci;
var exp1Max_c = exp1cRR + exp1Calls_ci;
var exp1cRR_TT = ((exp1cRR-exp1Calls_ci)*100).toFixed(2)+"% to "+((exp1cRR+exp1Calls_ci)*100).toFixed(2)+"%";

var exp1tRR = responseRate(exp1Visitors, exp1Total);
var exp1tRR_p = toPercent(exp1tRR, 2);
var exp1Total_se = se(exp1Total,exp1Visitors);
var exp1Total_ci = confInt(exp1Total_se,percentile);
var exp1Min_t = exp1tRR - exp1Total_ci;
var exp1Max_t = exp1tRR + exp1Total_ci;
var exp1tRR_TT = ((exp1tRR-exp1Total_ci)*100).toFixed(2)+"% to "+((exp1tRR+exp1Total_ci)*100).toFixed(2)+"%";


//------------------------------------

//Experience 2
var exp2Name = "Comp Top";
var exp2Visitors = 1043;
var exp2Forms = 250;
var exp2Calls = 43;
var exp2Total = exp2Forms + exp2Calls;

var exp2fRR = responseRate(exp2Visitors, exp2Forms);
var exp2fRR_p = toPercent(exp2fRR, 2);
var exp2Forms_se = se(exp2Forms,exp2Visitors);
var exp2Forms_ci = confInt(exp2Forms_se,percentile);
var exp2Min = exp2fRR - exp2Forms_ci;
var exp2Max = exp2fRR + exp2Forms_ci;
var exp2fRR_TT = ((exp2fRR-exp2Forms_ci)*100).toFixed(2)+"% to "+((exp2fRR+exp2Forms_ci)*100).toFixed(2)+"%";

var exp2cRR = responseRate(exp2Visitors, exp2Calls);
var exp2cRR_p = toPercent(exp2cRR, 2);
var exp2Calls_se = se(exp2Calls,exp2Visitors);
var exp2Calls_ci = confInt(exp2Calls_se,percentile);
var exp2Min_c = exp2cRR - exp2Calls_ci;
var exp2Max_c = exp2cRR + exp2Calls_ci;
var exp2cRR_TT = ((exp2cRR-exp2Calls_ci)*100).toFixed(2)+"% to "+((exp2cRR+exp2Calls_ci)*100).toFixed(2)+"%";

var exp2tRR = responseRate(exp2Visitors, exp2Total);
var exp2tRR_p = toPercent(exp2tRR, 2);
var exp2Total_se = se(exp2Total,exp2Visitors);
var exp2Total_ci = confInt(exp2Total_se,percentile);
var exp2Min_t = exp2tRR - exp2Total_ci;
var exp2Max_t = exp2tRR + exp2Total_ci;
var exp2tRR_TT = ((exp2tRR-exp2Total_ci)*100).toFixed(2)+"% to "+((exp2tRR+exp2Total_ci)*100).toFixed(2)+"%";

//-------------------------------------



//Calculations
function responseRate(visitors, conversions) {
    return (conversions / visitors);
}

function toPercent(toConvert, decimal) {
    var num = toConvert*100;
    return num.toFixed(decimal) + "%";
}

function se(conversions, visitors) {
    var p = conversions / visitors;
    var a = p * (1 - p);
    var b = a / visitors;
    var standerr = Math.sqrt(b);
    return standerr;
}

function confInt(standerr, sig) {
    var perctl;
    switch (sig) {
        case 0:
            perctl = 1.28;
            break;
        case 1:
            perctl = 1.65;
            break;
        case 2:
            perctl = 1.96;
            break;
        case 3:
            perctl = 2.58;
            break;
    }
    return standerr * perctl;
}
function ciDisplay(input){
var ci = input * 100;
return "<div class='ci'>&plusmn"+ci.toFixed(2)+"%</div>";
}

function lift (rrControl,rr2){
var num1 = ((rr2 - rrControl) / rrControl)*100;
return num1.toFixed(2)+"%";
}
function zscore (P,N,Pc,Nc){
    var Ac = Pc*(1-Pc);
    var Bc = Ac/Nc;
    /********************/
    var A = P*(1-P);
    var B = A/N;
    /******************/
    var C = B + Bc;
    var Numerator = P - Pc;
    var Denomninator = Math.sqrt(C);
  
    
return Numerator/Denomninator;
}
function cumnormdist(x) {
    var b1 = 0.319381530;
    var b2 = -0.356563782;
    var b3 = 1.781477937;
    var b4 = -1.821255978;
    var b5 = 1.330274429;
    var p = 0.2316419;
    var c = 0.39894228;
    var t;
    var taylor;
    var package;
    var exponent1;

    if (x >= 0) {

        t = 1.0 / (1.0 + p * x);
        exponent1 =  (-x * x) / 2.0;
        package = ( t *( t * ( t * ( t * b5 + b4 ) + b3 ) + b2 ) + b1 );
        taylor = 1.0 - c * Math.exp(exponent1) * t * package;
        return taylor;

    } else {
         t = 1.0 / (1.0 - p * x);
        exponent1 =  -x * x / 2.0;
        package = ( t *( t * ( t * ( t * b5 + b4 ) + b3 ) + b2 ) + b1 );
        taylor = (c * Math.exp(exponent1)) * t * package;
        return 1 - taylor;
    }
}

//Populate Experience Names
$(".exp1 td.experience").html(exp1Name + " [CONTROL]");
$(".exp2 td.experience").html(exp2Name);

//Populate Metrics
$(".exp1 td.visitors").html(exp1Visitors);
$(".exp1 td.forms").html(exp1Forms);
$(".exp1 td.calls").html(exp1Calls);
$(".exp1 td.total").html(exp1Total);

$(".exp2 td.visitors").html(exp2Visitors);
$(".exp2 td.forms").html(exp2Forms);
$(".exp2 td.calls").html(exp2Calls);
$(".exp2 td.total").html(exp2Total);

//Populate Outbound Leads (Forms)
$(".exp1 td.fRR").html(exp1fRR_p + " " + ciDisplay(exp1Forms_ci));
$(".exp1 td.fRR").attr("title",exp1fRR_TT);

$(".exp2 td.fRR").html(exp2fRR_p + " " + ciDisplay(exp2Forms_ci));
$(".exp2 td.fRR").attr("title",exp2fRR_TT);
$(".exp2 td.fLift").html(lift(exp1fRR,exp2fRR)+"<div class='ci'> ("+lift(exp1Max,exp2Min)+" to "+lift(exp1Min,exp2Max)+")</div>");
$(".exp2 td.fConf").html((cumnormdist(zscore(exp2fRR,exp2Visitors,exp1fRR,exp1Visitors))*100).toFixed(2)+"%");

//Populate Inbound Leads (Calls)
$(".exp1 td.cRR").html(exp1cRR_p + " " + ciDisplay(exp1Calls_ci));
$(".exp1 td.cRR").attr("title",exp1cRR_TT);

$(".exp2 td.cRR").html(exp2cRR_p + " " + ciDisplay(exp2Calls_ci));
$(".exp2 td.cRR").attr("title",exp2cRR_TT);
$(".exp2 td.cLift").html(lift(exp1cRR,exp2cRR)+"<div class='ci'> ("+lift(exp1Max_c,exp2Min_c)+" to "+lift(exp1Min_c,exp2Max_c)+")</div>");
$(".exp2 td.cConf").html((cumnormdist(zscore(exp2cRR,exp2Visitors,exp1cRR,exp1Visitors))*100).toFixed(2)+"%");

//Populate Total Leads
$(".exp1 td.tRR").html(exp1tRR_p + " " + ciDisplay(exp1Total_ci));
$(".exp1 td.tRR").attr("title",exp1tRR_TT);

$(".exp2 td.tRR").html(exp2tRR_p + " " + ciDisplay(exp2Total_ci));
$(".exp2 td.tRR").attr("title",exp2tRR_TT);
$(".exp2 td.tLift").html(lift(exp1tRR,exp2tRR)+"<div class='ci'> ("+lift(exp1Max_t,exp2Min_t)+" to "+lift(exp1Min_t,exp2Max_t)+")</div>");
$(".exp2 td.tConf").html((cumnormdist(zscore(exp2tRR,exp2Visitors,exp1tRR,exp1Visitors))*100).toFixed(2)+"%");
</script>
<style>
.margins{
    margin: 50px 100px 50px 100px;
    color:#5F5F5F;
}

table, tr, td, th {
    text-align: center;
    border-collapse: collapse;
    font-family:arial;
}


h1, h2, h3, h4 {
    text-align:center;
    margin:3px 0px 1px 0px;
    font-family: arial;
}

.ci {
    position:relative;
    float:right;
    font-size:14px;
    color:#666666;
}
</style>
</html>